# ğŸ”¥ Firebase Setup Guide

HÆ°á»›ng dáº«n chi tiáº¿t Ä‘á»ƒ setup Firebase cho á»©ng dá»¥ng Quáº£n lÃ½ Cáº§u lÃ´ng.

## ğŸ“‹ BÆ°á»›c 1: Táº¡o Firebase Project

1. Truy cáº­p [Firebase Console](https://console.firebase.google.com)
2. Click **"Add project"** hoáº·c **"Create a project"**
3. Nháº­p tÃªn project: `badminton-management` (hoáº·c tÃªn báº¡n muá»‘n)
4. Chá»n **"Continue"**
5. Táº¯t Google Analytics (khÃ´ng báº¯t buá»™c cho á»©ng dá»¥ng nÃ y)
6. Click **"Create project"**

## ğŸ”§ BÆ°á»›c 2: Cáº¥u hÃ¬nh Authentication

1. Trong Firebase Console, chá»n **"Authentication"** tá»« sidebar
2. Click tab **"Sign-in method"**
3. Enable **"Email/Password"**:
   - Click vÃ o **"Email/Password"**
   - Báº­t **"Enable"**
   - Click **"Save"**

## ğŸ—„ï¸ BÆ°á»›c 3: Táº¡o Firestore Database

1. Chá»n **"Firestore Database"** tá»« sidebar
2. Click **"Create database"**
3. Chá»n **"Start in test mode"** (táº¡m thá»i)
4. Chá»n location gáº§n nháº¥t (vÃ­ dá»¥: `asia-southeast1`)
5. Click **"Done"**

### Cáº­p nháº­t Firestore Rules
Sau khi táº¡o xong, cáº­p nháº­t rules:

```javascript
rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {
    
    // ============================================
    // HELPER FUNCTIONS
    // ============================================
    
    // Kiá»ƒm tra user Ä‘Ã£ Ä‘Äƒng nháº­p
    function isSignedIn() {
      return request.auth != null;
    }
    
    // Kiá»ƒm tra user cÃ³ pháº£i admin khÃ´ng
    function isAdmin() {
      return isSignedIn() && 
             get(/databases/$(database)/documents/users/$(request.auth.uid)).data.role == 'admin';
    }
    
    // Kiá»ƒm tra user cÃ³ active khÃ´ng
    function isActive() {
      return isSignedIn() && 
             get(/databases/$(database)/documents/users/$(request.auth.uid)).data.isActive == true;
    }
    
    // Kiá»ƒm tra user cÃ³ pháº£i chá»§ sá»Ÿ há»¯u document khÃ´ng
    function isOwner(userId) {
      return isSignedIn() && request.auth.uid == userId;
    }
    
    // ============================================
    // USERS COLLECTION
    // ============================================
    match /users/{userId} {
      // Äá»c: Chá»‰ user Ä‘Ã£ Ä‘Äƒng nháº­p
      allow read: if isSignedIn();
      
      // Táº¡o: Chá»‰ khi Ä‘Äƒng kÃ½ tÃ i khoáº£n má»›i (tá»± Ä‘á»™ng táº¡o document cho chÃ­nh mÃ¬nh)
      allow create: if isSignedIn() && 
                       request.auth.uid == userId &&
                       request.resource.data.role == 'user' && // Máº·c Ä‘á»‹nh lÃ  user
                       request.resource.data.isActive == true; // Máº·c Ä‘á»‹nh active
      
      // Cáº­p nháº­t: 
      // - Admin cÃ³ thá»ƒ cáº­p nháº­t báº¥t ká»³ user nÃ o
      // - User chá»‰ cÃ³ thá»ƒ cáº­p nháº­t thÃ´ng tin cÃ¡ nhÃ¢n cá»§a mÃ¬nh (KHÃ”NG Ä‘Æ°á»£c Ä‘á»•i role, isActive)
      allow update: if isAdmin() || 
                       (isOwner(userId) && 
                        request.resource.data.role == resource.data.role && // KhÃ´ng Ä‘Æ°á»£c tá»± Ä‘á»•i role
                        request.resource.data.isActive == resource.data.isActive); // KhÃ´ng Ä‘Æ°á»£c tá»± Ä‘á»•i isActive
      
      // XÃ³a: Chá»‰ admin
      allow delete: if isAdmin();
    }
    
    // ============================================
    // COURTS COLLECTION
    // ============================================
    match /courts/{courtId} {
      // Äá»c: User Ä‘Ã£ Ä‘Äƒng nháº­p vÃ  active
      allow read: if isActive();
      
      // Táº¡o/Cáº­p nháº­t/XÃ³a: Chá»‰ admin
      allow create, update, delete: if isAdmin();
    }
    
    // ============================================
    // MEMBERS COLLECTION
    // ============================================
    match /members/{memberId} {
      // Äá»c: User Ä‘Ã£ Ä‘Äƒng nháº­p vÃ  active
      allow read: if isActive();
      
      // Táº¡o/Cáº­p nháº­t/XÃ³a: Chá»‰ admin
      allow create, update, delete: if isAdmin();
    }
    
    // ============================================
    // GROUPS COLLECTION
    // ============================================
    match /groups/{groupId} {
      // Äá»c: User Ä‘Ã£ Ä‘Äƒng nháº­p vÃ  active
      allow read: if isActive();
      
      // Táº¡o/Cáº­p nháº­t/XÃ³a: Chá»‰ admin
      allow create, update, delete: if isAdmin();
    }
    
    // ============================================
    // SESSIONS COLLECTION
    // ============================================
    match /sessions/{sessionId} {
      // Äá»c: User Ä‘Ã£ Ä‘Äƒng nháº­p vÃ  active
      allow read: if isActive();
      
      // Táº¡o: User active cÃ³ thá»ƒ táº¡o session
      allow create: if isActive() && 
                       request.resource.data.createdBy == request.auth.uid;
      
      // Cáº­p nháº­t: 
      // - Admin cÃ³ thá»ƒ cáº­p nháº­t báº¥t ká»³ session nÃ o
      // - User chá»‰ cÃ³ thá»ƒ cáº­p nháº­t session cá»§a mÃ¬nh
      allow update: if isActive() && 
                       (isAdmin() || resource.data.createdBy == request.auth.uid);
      
      // XÃ³a:
      // - Admin cÃ³ thá»ƒ xÃ³a báº¥t ká»³ session nÃ o
      // - User chá»‰ cÃ³ thá»ƒ xÃ³a session cá»§a mÃ¬nh
      allow delete: if isActive() && 
                       (isAdmin() || resource.data.createdBy == request.auth.uid);
    }
    
    // ============================================
    // SETTINGS COLLECTION
    // ============================================
    match /settings/{settingId} {
      // Äá»c: Táº¥t cáº£ user Ä‘Ã£ Ä‘Äƒng nháº­p vÃ  active cÃ³ thá»ƒ Ä‘á»c settings
      allow read: if isActive();
      
      // Táº¡o/Cáº­p nháº­t/XÃ³a: Chá»‰ admin
      // Settings lÃ  cáº¥u hÃ¬nh há»‡ thá»‘ng, chá»‰ admin Ä‘Æ°á»£c thay Ä‘á»•i
      allow create, update, delete: if isAdmin();
    }
    
    // ============================================
    // DEFAULT: DENY ALL
    // ============================================
    // Má»i collection khÃ¡c Ä‘á»u bá»‹ tá»« chá»‘i truy cáº­p
    match /{document=**} {
      allow read, write: if false;
    }
  }
}
```

## ğŸ“± BÆ°á»›c 4: Táº¡o Web App

1. Trong Firebase Console, click vÃ o icon **"Web"** (`</>`)
2. Nháº­p tÃªn app: `Badminton PWA`
3. TÃ­ch **"Also set up Firebase Hosting"** (tÃ¹y chá»n)
4. Click **"Register app"**
5. **Copy thÃ´ng tin cáº¥u hÃ¬nh Firebase** hiá»ƒn thá»‹

## ğŸ” BÆ°á»›c 5: Cáº¥u hÃ¬nh Environment Variables

1. Táº¡o file `.env` tá»« `.env.example`:
```bash
cp .env.example .env
```

2. Äiá»n thÃ´ng tin Firebase vÃ o file `.env`:
```bash
# Tá»« Firebase Config Object
VITE_FIREBASE_API_KEY=AIzaSyXXXXXXXXXXXXXXXXXXXXXXXXXXX
VITE_FIREBASE_AUTH_DOMAIN=your-project.firebaseapp.com
VITE_FIREBASE_PROJECT_ID=your-project-id
VITE_FIREBASE_STORAGE_BUCKET=your-project.appspot.com
VITE_FIREBASE_MESSAGING_SENDER_ID=123456789012
VITE_FIREBASE_APP_ID=1:123456789012:web:abc123def456

# App Configuration
VITE_APP_NAME="Quáº£n LÃ½ Cáº§u LÃ´ng"
VITE_APP_VERSION="1.0.0"
VITE_DEV_MODE=false
VITE_USE_EMULATORS=false
```

## ğŸª BÆ°á»›c 6: Cáº¥u hÃ¬nh Storage (TÃ¹y chá»n)

1. Chá»n **"Storage"** tá»« sidebar
2. Click **"Get started"**
3. Chá»n **"Start in test mode"**
4. Chá»n location giá»‘ng Firestore
5. Click **"Done"**

## ğŸ‘¤ BÆ°á»›c 7: Táº¡o Admin User Ä‘áº§u tiÃªn

Sau khi cháº¡y á»©ng dá»¥ng láº§n Ä‘áº§u:

1. ÄÄƒng kÃ½ tÃ i khoáº£n Ä‘áº§u tiÃªn qua giao diá»‡n
2. VÃ o Firebase Console â†’ Authentication â†’ Users
3. TÃ¬m user vá»«a táº¡o, copy UID
4. VÃ o Firestore Database
5. Táº¡o collection `users` vá»›i document cÃ³ ID = UID
6. ThÃªm field `role` = `admin`

VÃ­ dá»¥ document structure:
```javascript
{
  displayName: "Your Name",
  email: "your@email.com",
  role: "admin",  // QUAN TRá»ŒNG: Set thÃ nh admin
  createdAt: firestore.Timestamp.now(),
  updatedAt: firestore.Timestamp.now()
}
```

## âœ… BÆ°á»›c 8: Test Configuration

Cháº¡y á»©ng dá»¥ng Ä‘á»ƒ test:

```bash
npm run dev
```

Kiá»ƒm tra trong Console (F12):
- âœ… "Firebase app initialized successfully"
- âœ… "Firebase config loaded"
- âŒ KhÃ´ng cÃ³ lá»—i "network-request-failed"

## ğŸš¨ Troubleshooting

### Lá»—i "auth/network-request-failed"

**NguyÃªn nhÃ¢n thÆ°á»ng gáº·p:**

1. **Sai cáº¥u hÃ¬nh Firebase**:
   ```bash
   # Kiá»ƒm tra file .env cÃ³ Ä‘Ãºng format khÃ´ng
   # Äáº£m báº£o khÃ´ng cÃ³ dáº¥u cÃ¡ch thá»«a
   # Project ID pháº£i chÃ­nh xÃ¡c
   ```

2. **Firebase project chÆ°a enable Authentication**:
   - VÃ o Authentication â†’ Sign-in method
   - Enable Email/Password

3. **Firestore chÆ°a Ä‘Æ°á»£c táº¡o**:
   - VÃ o Firestore Database
   - Create database náº¿u chÆ°a cÃ³

4. **Domain chÆ°a Ä‘Æ°á»£c authorize**:
   - VÃ o Authentication â†’ Settings â†’ Authorized domains
   - ThÃªm `localhost` vÃ  domain production

5. **Billing chÆ°a Ä‘Æ°á»£c setup** (cho production):
   - Má»™t sá»‘ tÃ­nh nÄƒng cáº§n Blaze plan

### Lá»—i "auth/operation-not-allowed"

```bash
# VÃ o Firebase Console
# Authentication â†’ Sign-in method
# Enable Email/Password provider
```

### Lá»—i CORS hoáº·c network

```bash
# ThÃªm domain vÃ o Authorized domains:
# Authentication â†’ Settings â†’ Authorized domains
# ThÃªm: localhost, 127.0.0.1, domain-production.com
```

## ğŸš€ Production Setup

Khi deploy lÃªn production:

1. **Update Authorized Domains**:
   - ThÃªm domain production vÃ o Authentication â†’ Settings

2. **Update Firestore Rules**:
   - Chuyá»ƒn tá»« test mode sang production rules

3. **Environment Variables**:
   ```bash
   VITE_DEV_MODE=false
   VITE_USE_EMULATORS=false
   ```

4. **Firebase Hosting** (tÃ¹y chá»n):
   ```bash
   npm run build
   firebase deploy
   ```

## ğŸ“ Support

Náº¿u váº«n gáº·p lá»—i:

1. Kiá»ƒm tra Firebase Console cÃ³ bÃ¡o lá»—i khÃ´ng
2. Xem Network tab trong DevTools
3. Kiá»ƒm tra file .env cÃ³ Ä‘Ãºng format khÃ´ng
4. Thá»­ táº¡o Firebase project má»›i
5. Contact support vá»›i log chi tiáº¿t

---

**LÆ°u Ã½**: Thay tháº¿ táº¥t cáº£ `your-project-id` báº±ng Project ID thá»±c táº¿ tá»« Firebase Console.